<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crash Game Final</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e);
      color: white;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }
    /* Wallet */
    #wallet-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #ff0080;
      padding: 5px 15px;
      border-radius: 16px;
      font-weight: bold;
      font-size: 1.1em;
      box-shadow: 0 1px 8px rgba(0,0,0,0.5);
      z-index: 10;
    }
    #wallet-container::before {
      content: "$";
      margin-right: 2px;
    }

    /* Game area */
    #game-container {
      flex: 0 0 65vh;
      position: relative;
      background: radial-gradient(circle at 50% 80%, #23235b 50%, #181842 100%);
      overflow: hidden;
    }
    #plane {
      position: absolute;
      width: 162px; /* 10% smaller */
      bottom: 0;
      left: 0;
      will-change: transform;
    }
    #multiplierFloat {
      position: absolute;
      color: #00ff99;
      font-size: 1.6em;
      font-weight: bold;
      text-shadow: 0 0 6px #000, 0 0 8px #00ff99;
      white-space: nowrap;
      pointer-events: none;
    }

    /* Controls */
    #controls {
      flex: 0 0 auto;
      background: #111;
      padding: 10px 5px 5px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    #countdown {
      width: 100%;
      text-align: center;
      color: #ffaa00;
      margin-bottom: 5px;
      font-size: 1em;
    }
    #betAmount {
      width: 80px;
      padding: 6px;
      font-size: 1em;
      border-radius: 6px;
      border: none;
      text-align: center;
    }
    .bet-options {
      display: flex;
      gap: 6px;
    }
    .bet-options button {
      padding: 6px 12px;
      font-size: .9em;
      border: none;
      border-radius: 5px;
      background: #333;
      cursor: pointer;
      transition: background .3s;
    }
    .bet-options button:hover {
      background: #ff0080;
      color: white;
    }
    #btn-group {
      display: flex;
      gap: 10px;
      margin-top: 4px;
      margin-bottom: 5px;
    }
    #startBtn, #cashoutBtn {
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      min-width: 100px;
    }
    #startBtn {
      background: #ff0080;
      color: white;
    }
    #startBtn:disabled {
      background: #b94c80;
      cursor: not-allowed;
    }
    #cashoutBtn {
      background: #333;
      color: white;
    }
    #cashoutBtn:disabled {
      background: #555;
      cursor: not-allowed;
    }

    /* Fake players */
    #players {
      flex: 0 0 15vh;
      background: #16162f;
      overflow-y: auto;
      padding: 5px 10px;
      font-size: .9em;
    }
    #players .player {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      color: #ccc;
    }
    #players .player.win { color: #0f0; }
    #players .player.lose { color: #f33; }

    @media (max-width:600px) {
      #plane { width: 120px; }
      #multiplierFloat { font-size: 1.2em; }
      #wallet-container { font-size: 1em; padding: 4px 12px; }
      .bet-options button { padding:5px 10px; font-size:.8em; }
      #startBtn,#cashoutBtn { padding:8px 16px; font-size:.9em; min-width:80px; }
    }
  </style>
</head>
<body>

  <div id="wallet-container">100</div>

  <div id="game-container">
    <img id="plane" src="https://cdn-icons-png.flaticon.com/512/483/483361.png" alt="Plane">
    <div id="multiplierFloat">1.00x</div>
  </div>

  <div id="controls">
    <div id="countdown">Next round in 3s</div>
    <input id="betAmount" type="number" min="1" value="10">
    <div class="bet-options">
      <button data-val="5">5</button>
      <button data-val="10">10</button>
      <button data-val="20">20</button>
      <button data-val="1000">1000</button>
    </div>
    <div id="btn-group">
      <button id="startBtn">وضع رهان</button>
      <button id="cashoutBtn" disabled>سحب الأرباح</button>
    </div>
  </div>

  <div id="players">
    <!-- Fake players go here -->
  </div>

  <audio id="flySound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_b208bd429.mp3"></audio>
  <audio id="explosionSound" src="https://cdn.pixabay.com/audio/2021/09/01/audio_28472dc45.mp3"></audio>

  <script>
    const plane = document.getElementById('plane'),
          multF = document.getElementById('multiplierFloat'),
          walletEl = document.getElementById('wallet-container'),
          countdownEl = document.getElementById('countdown'),
          betInput = document.getElementById('betAmount'),
          betBtns = document.querySelectorAll('.bet-options button'),
          startBtn = document.getElementById('startBtn'),
          cashoutBtn = document.getElementById('cashoutBtn'),
          playersEl = document.getElementById('players'),
          flySound = document.getElementById('flySound'),
          explosionSound = document.getElementById('explosionSound');

    let wallet = 100, bet=10, multiplier=1, crashed=false,
        playing=false, placed=false, posX=0,posY=0,
        cycleActive=false, cnt=3, ci, gi, pi;

    // fake players data
    const names = ['amir**','yass**','samir*','hkhl**','noura*'];
    function randomPlayers(){
      playersEl.innerHTML = '';
      for(let i=0;i<5;i++){
        let name = names[Math.floor(Math.random()*names.length)];
        let mlt = (Math.random()*5).toFixed(2);
        let stake = [5,10,20,1000][Math.floor(Math.random()*4)];
        let win = Math.random()<0.5 ? 0 : (mlt*stake).toFixed(2);
        const div = document.createElement('div');
        div.className='player '+(win>0?'win':'lose');
        div.innerHTML = `<span>${name}</span><span>${win>0?'+':''}${win} MAD</span>`;
        playersEl.appendChild(div);
      }
    }
    // update wallet display
    function updW(){ walletEl.textContent = Math.floor(wallet); }

    // reset
    function reset(){
      clearInterval(gi); clearInterval(ci);
      crashed=playing=placed=false; multiplier=1;
      posX=posY=0;
      plane.style.transform='translate(0,0)'; plane.style.display='block';
      multF.style.transform='translate(10px,10px)'; multF.textContent='1.00x';
      startBtn.disabled=false; cashoutBtn.disabled=true;
      cnt=3; countdownEl.textContent='Next round in '+cnt+'s';
      cycleActive=false;
    }

    function startCycle(){
      if(cycleActive) return;
      reset(); cycleActive=true;
      ci = setInterval(()=>{
        cnt--;
        if(cnt>0){
          countdownEl.textContent='Next round in '+cnt+'s';
        } else {
          clearInterval(ci);
          countdownEl.textContent='🚀';
          startFly();
        }
      },1000);
    }

    function startFly(){
      playSound(flySound);
      if(placed && wallet>=bet) wallet-=bet, updW();
      playing=true; startBtn.disabled=true; cashoutBtn.disabled=false;
      gi = setInterval(()=>{
        multiplier+=0.01;
        multF.textContent = multiplier.toFixed(2)+'x';
        posX+=3; posY+=2;
        plane.style.transform = `translate(${posX}px, -${posY}px)`;
        multF.style.transform = `translate(${posX+10}px, ${-posY+10}px)`;
        if(Math.random()<0.01*multiplier || posX>window.innerWidth-150){
          crash();
        }
      },50);
    }

    function crash(){
      crashed=true; playing=false; cycleActive=false;
      clearInterval(gi);
      playSound(explosionSound);
      multF.textContent = '💥'+multiplier.toFixed(2)+'x';
      plane.style.display='none';
      if(placed){ placed=false; } // lose stake already deducted
      startBtn.disabled=false; cashoutBtn.disabled=true;
      setTimeout(startCycle,2000);
    }

    function place(){
      if(!playing && !placed){
        bet = parseInt(betInput.value)||1;
        if(bet>wallet){ alert('رصيد غير كافي'); return; }
        placed=true;
      }
    }
    function cashOut(){
      if(playing && placed && !crashed){
        placed=false; playing=false;
        clearInterval(gi);
        let win = bet*multiplier;
        wallet+=win; updW();
        multF.textContent = '✅'+win.toFixed(2)+'$';
        cashoutBtn.disabled=true; startBtn.disabled=false;
      }
    }
    function playSound(s){ s.currentTime=0; s.play(); }

    // handlers
    betBtns.forEach(b=>b.onclick=()=>betInput.value=b.dataset.val);
    startBtn.onclick=place;
    cashoutBtn.onclick=cashOut;

    // init
    updW(); randomPlayers();
    pi = setInterval(randomPlayers,2000);
    startCycle();
  </script>
</body>
</html>
